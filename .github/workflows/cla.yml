name: Require CLA Agreement
on:
    workflow_dispatch:
    issue_comment:
        types:
            - created
    pull_request_target:
        types:
            - opened
            - closed
            - synchronize
permissions:
    actions: write
    contents: write
    pull-requests: write
    statuses: write
    id-token: write
jobs:
    assistant:
        name: Assistant
        runs-on: ubuntu-latest
        steps:
            - name: App Token
              uses: actions/create-github-app-token@v1
              id: token
              with:
                  app-id: ${{ vars.APP_ID }}
                  private-key: ${{ secrets.APP_PRIVATE_KEY }}

            - name: Access Token
              uses: qoomon/actions--access-token@v3
              id: pat
              with:
                  permissions: |
                      actions: write
                      contents: write
                      pull-requests: write
                      statuses: write

            - name: CLA Assistant
              uses: cla-assistant/github-action@v2.4.0
              if: (github.event.comment.body == 'recheck' || github.event.comment.body == 'I have read the CLA document and hereby sign & accept the CLA agreement') || github.event_name == 'pull_request_target'
              env:
                  GITHUB_TOKEN: ${{ steps.token.outputs.token }}
                  PERSONAL_ACCESS_TOKEN: ${{ steps.pat.outputs.token }}
              with:
                  path-to-signatures: signatures.json
                  path-to-document: 'https://github.com/jarsft/.github/blob/production/CLA.md'
                  branch: production
                  allowlist: bot*

                  remote-organization-name: jarsft
                  remote-repository-name: signatures
                  create-file-commit-message: 'feat: created file for CLA signatures'
                  signed-commit-message: 'chore: $contributorName has signed the CLA in $owner/$repo#$pullRequestNo'
                  custom-notsigned-prcomment: 'To continue with merging the pull-request, please sign the CLA (Contributor License Agreement).'
                  # custom-pr-sign-comment: 'I have read the CLA document and hereby sign & accept the CLA agreement'
                  custom-allsigned-prcomment: '**CLA Status** - All contributors have signed the CLA.'
                  # lock-pullrequest-aftermerge: false - if you don't want this bot to automatically lock the pull request after merging (default - true)
                  # use-dco-flag: true - If you are using DCO instead of CLA
